---
title: "`[].flatMap()`"
description: ""
authors:
  - AntonGorelov
tags:
  - doka
---

## Кратко

Метод `flatMap()` позволяет сформировать массив, применяя функцию к каждому элементу, затем уменьшает вложенность, делая плоскую структуру, и возвращает новый массив.

Был добавлен в стандарте ES2019.

## Пример

### Получить плоский список из сложной структуры

Представим, что у нас есть список заказов пользователей из которого мы хотим понять, какие товары заказывают:

```js
const orders = [
    {
        id: 1,
        products: [
            { name: 'Чизкейк', price: 1.99 },
            { name: 'Бисквит', price: 4.99 },
        ]
    },
    {
        id: 2,
        products: [
            { name: 'Шоколад', price: 5.59 },
            { name: 'Зефир', price: 8.99 },
        ]
    }
]
```

Вызовем метод `flatMap()`:

```js
orders.flatMap(
  (order) => order.products.map(product => product.name)
)
```

Увидим что функция применилась, уменьшилась вложенность и мы получили только названия продуктов из массива `products`:

```js
['Чизкейк', 'Бисквит', 'Шоколад', 'Зефир']
```

### Модификация структуры данных

Представим, что мы пишем корзину для интернет-магазина. Товары в корзине храним в виде объекта:

```js
const cart = [
  {
    name: 'Телефон',
    count: 1,
    price: 500,
  },
  {
    name: 'Ноутбук',
    count: 1,
    price: 800,
  }
]
```

Если человек покупает телефон, то требуется добавить зарядное устройство. Для этого вызовем `flatMap()` и будем возвращать массив из телефона и зарядника вместо одного объекта с телефоном.

```js
cart.flatMap(
  (item) => {
    if (item.name === 'Телефон') {
      return [item, {
       name: 'Зарядник',
       count: item.count,
       price: 50,
      }]
    }

    return item
  }
)
```

`flatMap()` сделает массив плоским и мы получим массив элементов в корзине:

```js
[
  {
    name:'Телефон',
    count:1,
    price:500,
  }, {
    name:'Зарядник',
    count:1,
    price:50,
  }, {
    name:'Ноутбук',
    count:1,
    price:800,
  },
]
```

## Как пишется

Как и другим похожим методам, `flatMap()` необходимо передать колбэк-функцию, которая будет возвращать какое-то значение. Именно это значение попадёт в итоговый массив.

Функция, которую мы передаём в `flatMap()`, принимает три аргумента:

- `currentValue` — текущий элемент массива.
- `index` — индекс текущего элемента в массиве.
- `array` — массив, который мы перебираем.

## Как понять

Метод идентичен `map().flat()` с `depth = 1`, но более эффективный, чем вызов этих функций по отдельности; соответственно, применяется для трансформации исходных данных, с уменьшением вложенности.
